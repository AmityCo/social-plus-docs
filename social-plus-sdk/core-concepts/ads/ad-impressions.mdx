# Ad Impressions Tracking

Track ad performance with comprehensive impression and click analytics to optimize your monetization strategy.

<Info>
**Analytics Insight**: Impressions count total views while reach counts unique users. Data updates in near real-time for accurate performance monitoring.
</Info>

## Overview

Ad impression tracking enables you to:

- **Monitor Performance**: Track how your ads are performing across different placements
- **Measure Engagement**: Understand user interaction with your advertisements
- **Optimize Strategy**: Use data to improve ad placement and frequency
- **Revenue Analytics**: Correlate impressions and clicks with revenue metrics

### Key Metrics

- **Impressions**: Total number of times an ad was viewed
- **Reach**: Number of unique users who viewed the ad
- **Click-through Rate (CTR)**: Percentage of impressions that resulted in clicks
- **Engagement Rate**: Overall interaction with ad content

## Mark Ad as Seen

Track when users view an ad to measure impression and reach metrics.

<Warning>
**Implementation Note**: Call `markAsSeen()` when the ad becomes visible to the user, not when it's loaded in memory.
</Warning>

<Tabs>
  <Tab title="iOS">
    ```swift
    import AmitySDK

    let adRepository = AmityAdRepository(client: client)
    
    // Mark ad as seen when it becomes visible
    func markAdAsSeen(adId: String) {
        adRepository.markAsSeen(adId: adId) { result in
            switch result {
            case .success:
                print("Ad impression tracked successfully")
                // Optionally update local analytics
                updateLocalImpressionCount(adId: adId)
                
            case .failure(let error):
                print("Failed to track impression: \(error.localizedDescription)")
                // Handle error - maybe retry or log for later sync
            }
        }
    }
    
    // Usage with scroll detection
    func scrollViewDidScroll(_ scrollView: UIScrollView) {
        let visibleCells = tableView.visibleCells
        
        for cell in visibleCells {
            if let adCell = cell as? AdTableViewCell {
                // Check if ad is sufficiently visible (e.g., 50% visible)
                if isAdSufficientlyVisible(cell: adCell) && !adCell.isImpressionTracked {
                    markAdAsSeen(adId: adCell.adId)
                    adCell.isImpressionTracked = true
                }
            }
        }
    }
    
    private func isAdSufficientlyVisible(cell: UITableViewCell) -> Bool {
        let cellRect = tableView.rectForRow(at: tableView.indexPath(for: cell)!)
        let visibleRect = tableView.bounds
        let intersection = cellRect.intersection(visibleRect)
        
        // Consider ad "seen" if 50% or more is visible
        return intersection.height >= cellRect.height * 0.5
    }
    ```
  </Tab>
  <Tab title="Android">
    ```kotlin
    import com.amity.socialcloud.sdk.ads.AmityAdRepository

    val adRepository = AmityAdRepository(client)
    
    // Mark ad as seen when it becomes visible
    fun markAdAsSeen(adId: String) {
        adRepository.markAsSeen(adId)
            .observeOn(AndroidSchedulers.mainThread())
            .subscribe(
                {
                    println("Ad impression tracked successfully")
                    // Update local analytics if needed
                    updateLocalImpressionCount(adId)
                },
                { error ->
                    println("Failed to track impression: ${error.message}")
                    // Handle error appropriately
                }
            )
    }
    
    // Usage with RecyclerView scroll listener
    class AdScrollListener : RecyclerView.OnScrollListener() {
        private val trackedAds = mutableSetOf<String>()
        
        override fun onScrolled(recyclerView: RecyclerView, dx: Int, dy: Int) {
            super.onScrolled(recyclerView, dx, dy)
            
            val layoutManager = recyclerView.layoutManager as LinearLayoutManager
            val firstVisiblePosition = layoutManager.findFirstVisibleItemPosition()
            val lastVisiblePosition = layoutManager.findLastVisibleItemPosition()
            
            for (position in firstVisiblePosition..lastVisiblePosition) {
                val viewHolder = recyclerView.findViewHolderForAdapterPosition(position)
                
                if (viewHolder is AdViewHolder) {
                    val adId = viewHolder.adId
                    
                    // Check if ad is sufficiently visible and not already tracked
                    if (isAdSufficientlyVisible(viewHolder) && !trackedAds.contains(adId)) {
                        markAdAsSeen(adId)
                        trackedAds.add(adId)
                    }
                }
            }
        }
        
        private fun isAdSufficientlyVisible(viewHolder: RecyclerView.ViewHolder): Boolean {
            val view = viewHolder.itemView
            val rect = Rect()
            val isVisible = view.getGlobalVisibleRect(rect)
            
            // Consider ad "seen" if 50% or more is visible
            return isVisible && rect.height() >= view.height * 0.5
        }
    }
    ```
  </Tab>
  <Tab title="TypeScript">
    ```typescript
    import { AmityAdRepository } from '@amityco/ts-sdk';

    const adRepository = new AmityAdRepository(client);
    
    // Track ad impressions with visibility detection
    class AdImpressionTracker {
        private trackedAds = new Set<string>();
        private observer?: IntersectionObserver;
        
        constructor() {
            this.setupIntersectionObserver();
        }
        
        private setupIntersectionObserver(): void {
            this.observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach(entry => {
                        const adElement = entry.target as HTMLElement;
                        const adId = adElement.dataset.adId;
                        
                        // Track impression when ad is 50% visible
                        if (entry.intersectionRatio >= 0.5 && adId && !this.trackedAds.has(adId)) {
                            this.markAdAsSeen(adId);
                            this.trackedAds.add(adId);
                        }
                    });
                },
                {
                    threshold: 0.5 // Trigger when 50% visible
                }
            );
        }
        
        async markAdAsSeen(adId: string): Promise<void> {
            try {
                await adRepository.markAsSeen(adId);
                console.log('Ad impression tracked:', adId);
                
                // Optional: Update local analytics
                this.updateLocalAnalytics(adId, 'impression');
                
            } catch (error) {
                console.error('Failed to track impression:', error);
                // Implement retry logic or offline storage
                this.queueForRetry(adId, 'impression');
            }
        }
        
        // Observe ad elements for visibility tracking
        observeAd(adElement: HTMLElement): void {
            if (this.observer && adElement.dataset.adId) {
                this.observer.observe(adElement);
            }
        }
        
        private updateLocalAnalytics(adId: string, type: 'impression' | 'click'): void {
            // Update local analytics store
            const analytics = JSON.parse(localStorage.getItem('ad_analytics') || '{}');
            analytics[adId] = analytics[adId] || { impressions: 0, clicks: 0 };
            analytics[adId][type === 'impression' ? 'impressions' : 'clicks']++;
            localStorage.setItem('ad_analytics', JSON.stringify(analytics));
        }
        
        private queueForRetry(adId: string, action: string): void {
            // Queue failed tracking attempts for retry
            const queue = JSON.parse(localStorage.getItem('ad_retry_queue') || '[]');
            queue.push({ adId, action, timestamp: Date.now() });
            localStorage.setItem('ad_retry_queue', JSON.stringify(queue));
        }
    }
    
    // Usage in React component
    const AdComponent: React.FC<{ adId: string; content: any }> = ({ adId, content }) => {
        const adRef = useRef<HTMLDivElement>(null);
        const tracker = useRef(new AdImpressionTracker()).current;
        
        useEffect(() => {
            if (adRef.current) {
                adRef.current.dataset.adId = adId;
                tracker.observeAd(adRef.current);
            }
        }, [adId, tracker]);
        
        return (
            <div ref={adRef} className="ad-container">
                {/* Ad content */}
            </div>
        );
    };
    ```
  </Tab>
  <Tab title="React Native">
    ```typescript
    import { AmityAdRepository } from '@amityco/react-native-sdk';

    const adRepository = new AmityAdRepository(client);
    
    // Hook for tracking ad impressions
    const useAdTracking = () => {
        const trackedAds = useRef(new Set<string>()).current;
        
        const markAdAsSeen = async (adId: string): Promise<void> => {
            if (trackedAds.has(adId)) return;
            
            try {
                await adRepository.markAsSeen(adId);
                trackedAds.add(adId);
                console.log('Ad impression tracked:', adId);
            } catch (error) {
                console.error('Failed to track impression:', error);
            }
        };
        
        return { markAdAsSeen };
    };
    
    // Component with visibility tracking
    const AdCard: React.FC<{ ad: AdSetting }> = ({ ad }) => {
        const { markAdAsSeen } = useAdTracking();
        const [isVisible, setIsVisible] = useState(false);
        
        const onViewableItemsChanged = useCallback(({ viewableItems }) => {
            const adVisible = viewableItems.some(item => item.key === ad.adId);
            
            if (adVisible && !isVisible) {
                setIsVisible(true);
                markAdAsSeen(ad.adId);
            }
        }, [ad.adId, isVisible, markAdAsSeen]);
        
        const viewabilityConfig = {
            itemVisiblePercentThreshold: 50, // 50% visibility threshold
            minimumViewTime: 1000 // 1 second minimum view time
        };
        
        return (
            <View>
                {/* Ad content */}
                <Image source={{ uri: ad.content.imageUrl }} />
                <Text>{ad.content.title}</Text>
            </View>
        );
    };
    ```
  </Tab>
  <Tab title="Flutter">
    ```dart
    import 'package:amity_sdk/amity_sdk.dart';
    import 'package:visibility_detector/visibility_detector.dart';

    class AdImpressionTracker {
      final AmityAdRepository _adRepository;
      final Set<String> _trackedAds = <String>{};
      
      AdImpressionTracker(AmityClient client) 
          : _adRepository = AmityAdRepository(client);
      
      Future<void> markAdAsSeen(String adId) async {
        if (_trackedAds.contains(adId)) return;
        
        try {
          await _adRepository.markAsSeen(adId);
          _trackedAds.add(adId);
          print('Ad impression tracked: $adId');
          
          // Update local analytics if needed
          _updateLocalAnalytics(adId, 'impression');
          
        } catch (error) {
          print('Failed to track impression: $error');
          // Handle error - maybe queue for retry
        }
      }
      
      void _updateLocalAnalytics(String adId, String type) {
        // Implement local analytics storage
        // This could use SharedPreferences or local database
      }
    }
    
    // Widget with visibility detection
    class AdWidget extends StatefulWidget {
      final AmityAdSetting adSetting;
      final AdImpressionTracker tracker;
      
      const AdWidget({
        Key? key,
        required this.adSetting,
        required this.tracker,
      }) : super(key: key);
      
      @override
      _AdWidgetState createState() => _AdWidgetState();
    }
    
    class _AdWidgetState extends State<AdWidget> {
      bool _hasTrackedImpression = false;
      
      @override
      Widget build(BuildContext context) {
        return VisibilityDetector(
          key: Key('ad-${widget.adSetting.adId}'),
          onVisibilityChanged: (VisibilityInfo info) {
            // Track impression when 50% visible
            if (info.visibleFraction >= 0.5 && !_hasTrackedImpression) {
              widget.tracker.markAdAsSeen(widget.adSetting.adId);
              setState(() {
                _hasTrackedImpression = true;
              });
            }
          },
          child: Container(
            margin: EdgeInsets.all(8.0),
            padding: EdgeInsets.all(16.0),
            decoration: BoxDecoration(
              border: Border.all(color: Colors.grey[300]!),
              borderRadius: BorderRadius.circular(8.0),
            ),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                if (widget.adSetting.content.imageUrl != null)
                  Image.network(
                    widget.adSetting.content.imageUrl!,
                    height: 200,
                    width: double.infinity,
                    fit: BoxFit.cover,
                  ),
                SizedBox(height: 8),
                Text(
                  widget.adSetting.content.title ?? '',
                  style: TextStyle(
                    fontSize: 18,
                    fontWeight: FontWeight.bold,
                  ),
                ),
                SizedBox(height: 4),
                Text(
                  widget.adSetting.content.description ?? '',
                  style: TextStyle(fontSize: 14),
                ),
              ],
            ),
          ),
        );
      }
    }
    ```
  </Tab>
</Tabs>

## Track Ad Clicks

Monitor user clicks on ads to measure engagement and calculate click-through rates (CTR).

<Info>
**CTR Calculation**: Click-through rate is automatically calculated as (clicks รท impressions) ร 100 in your analytics dashboard.
</Info>

<Tabs>
  <Tab title="iOS">
    ```swift
    import AmitySDK

    let adRepository = AmityAdRepository(client: client)
    
    // Track ad click when user interacts with ad
    func handleAdClick(adId: String) {
        adRepository.markLinkAsClicked(adId: adId) { result in
            switch result {
            case .success:
                print("Ad click tracked successfully")
                // Update local analytics
                updateLocalClickCount(adId: adId)
                
                // Navigate to ad destination or perform action
                openAdDestination(adId: adId)
                
            case .failure(let error):
                print("Failed to track click: \(error.localizedDescription)")
                // Still allow navigation even if tracking fails
                openAdDestination(adId: adId)
            }
        }
    }
    
    // Usage in ad button tap handler
    @IBAction func adTapped(_ sender: UIButton) {
        guard let adId = sender.accessibilityIdentifier else { return }
        handleAdClick(adId: adId)
    }
    
    private func openAdDestination(adId: String) {
        // Open ad URL or perform configured action
        if let adSetting = getAdSetting(adId: adId),
           let urlString = adSetting.content.linkUrl,
           let url = URL(string: urlString) {
            UIApplication.shared.open(url)
        }
    }
    ```
  </Tab>
  <Tab title="Android">
    ```kotlin
    import com.amity.socialcloud.sdk.ads.AmityAdRepository

    val adRepository = AmityAdRepository(client)
    
    // Track ad click when user interacts with ad
    fun handleAdClick(adId: String) {
        adRepository.markLinkAsClicked(adId)
            .observeOn(AndroidSchedulers.mainThread())
            .subscribe(
                {
                    println("Ad click tracked successfully")
                    // Update local analytics
                    updateLocalClickCount(adId)
                    
                    // Navigate to ad destination
                    openAdDestination(adId)
                },
                { error ->
                    println("Failed to track click: ${error.message}")
                    // Still allow navigation even if tracking fails
                    openAdDestination(adId)
                }
            )
    }
    
    // Usage in click listener
    private fun setupAdClickListener(adView: View, adId: String) {
        adView.setOnClickListener {
            handleAdClick(adId)
        }
    }
    
    private fun openAdDestination(adId: String) {
        val adSetting = getAdSetting(adId)
        adSetting?.content?.linkUrl?.let { url ->
            val intent = Intent(Intent.ACTION_VIEW, Uri.parse(url))
            startActivity(intent)
        }
    }
    ```
  </Tab>
  <Tab title="TypeScript">
    ```typescript
    import { AmityAdRepository } from '@amityco/ts-sdk';

    const adRepository = new AmityAdRepository(client);
    
    class AdClickTracker {
        
        async handleAdClick(adId: string, adSetting: AdSetting): Promise<void> {
            try {
                // Track the click
                await adRepository.markLinkAsClicked(adId);
                console.log('Ad click tracked:', adId);
                
                // Update local analytics
                this.updateLocalAnalytics(adId, 'click');
                
                // Navigate to ad destination
                this.openAdDestination(adSetting);
                
            } catch (error) {
                console.error('Failed to track click:', error);
                // Still navigate even if tracking fails
                this.openAdDestination(adSetting);
            }
        }
        
        private openAdDestination(adSetting: AdSetting): void {
            if (adSetting.content.linkUrl) {
                window.open(adSetting.content.linkUrl, '_blank');
            } else if (adSetting.content.action) {
                // Handle custom actions
                this.handleCustomAction(adSetting.content.action);
            }
        }
        
        private handleCustomAction(action: any): void {
            // Handle custom ad actions like app downloads, 
            // internal navigation, etc.
            switch (action.type) {
                case 'navigate':
                    window.location.href = action.url;
                    break;
                case 'modal':
                    // Show modal with more info
                    break;
                default:
                    console.warn('Unknown ad action:', action);
            }
        }
        
        private updateLocalAnalytics(adId: string, type: 'click'): void {
            const analytics = JSON.parse(localStorage.getItem('ad_analytics') || '{}');
            analytics[adId] = analytics[adId] || { impressions: 0, clicks: 0 };
            analytics[adId].clicks++;
            localStorage.setItem('ad_analytics', JSON.stringify(analytics));
        }
    }
    
    // Usage in React component
    const AdComponent: React.FC<{ adSetting: AdSetting }> = ({ adSetting }) => {
        const clickTracker = useRef(new AdClickTracker()).current;
        
        const handleClick = () => {
            clickTracker.handleAdClick(adSetting.adId, adSetting);
        };
        
        return (
            <div className="ad-container" onClick={handleClick} style={{ cursor: 'pointer' }}>
                <img src={adSetting.content.imageUrl} alt="Ad" />
                <div className="ad-content">
                    <h3>{adSetting.content.title}</h3>
                    <p>{adSetting.content.description}</p>
                    <button className="ad-cta">
                        {adSetting.content.buttonText || 'Learn More'}
                    </button>
                </div>
            </div>
        );
    };
    ```
  </Tab>
  <Tab title="React Native">
    ```typescript
    import { AmityAdRepository } from '@amityco/react-native-sdk';
    import { Linking } from 'react-native';

    const adRepository = new AmityAdRepository(client);
    
    const useAdClickTracking = () => {
        const handleAdClick = async (adId: string, linkUrl?: string): Promise<void> => {
            try {
                // Track the click
                await adRepository.markLinkAsClicked(adId);
                console.log('Ad click tracked:', adId);
                
                // Open the ad destination
                if (linkUrl) {
                    const supported = await Linking.canOpenURL(linkUrl);
                    if (supported) {
                        await Linking.openURL(linkUrl);
                    } else {
                        Alert.alert('Error', 'Cannot open this link');
                    }
                }
                
            } catch (error) {
                console.error('Failed to track click:', error);
                // Still try to open link even if tracking fails
                if (linkUrl) {
                    Linking.openURL(linkUrl).catch(() => {
                        Alert.alert('Error', 'Cannot open this link');
                    });
                }
            }
        };
        
        return { handleAdClick };
    };
    
    // Usage in component
    const AdCard: React.FC<{ ad: AdSetting }> = ({ ad }) => {
        const { handleAdClick } = useAdClickTracking();
        
        const onPress = () => {
            handleAdClick(ad.adId, ad.content.linkUrl);
        };
        
        return (
            <TouchableOpacity onPress={onPress} style={styles.adContainer}>
                <Image source={{ uri: ad.content.imageUrl }} style={styles.adImage} />
                <View style={styles.adContent}>
                    <Text style={styles.adTitle}>{ad.content.title}</Text>
                    <Text style={styles.adDescription}>{ad.content.description}</Text>
                    <View style={styles.ctaButton}>
                        <Text style={styles.ctaText}>
                            {ad.content.buttonText || 'Learn More'}
                        </Text>
                    </View>
                </View>
            </TouchableOpacity>
        );
    };
    ```
  </Tab>
  <Tab title="Flutter">
    ```dart
    import 'package:amity_sdk/amity_sdk.dart';
    import 'package:url_launcher/url_launcher.dart';

    class AdClickTracker {
      final AmityAdRepository _adRepository;
      
      AdClickTracker(AmityClient client) 
          : _adRepository = AmityAdRepository(client);
      
      Future<void> handleAdClick(String adId, {String? linkUrl}) async {
        try {
          // Track the click
          await _adRepository.markLinkAsClicked(adId);
          print('Ad click tracked: $adId');
          
          // Open ad destination
          if (linkUrl != null) {
            await _openUrl(linkUrl);
          }
          
        } catch (error) {
          print('Failed to track click: $error');
          // Still try to open link even if tracking fails
          if (linkUrl != null) {
            await _openUrl(linkUrl);
          }
        }
      }
      
      Future<void> _openUrl(String url) async {
        final uri = Uri.parse(url);
        if (await canLaunchUrl(uri)) {
          await launchUrl(uri, mode: LaunchMode.externalApplication);
        } else {
          print('Could not launch $url');
        }
      }
    }
    
    // Clickable ad widget
    class ClickableAdWidget extends StatelessWidget {
      final AmityAdSetting adSetting;
      final AdClickTracker clickTracker;
      
      const ClickableAdWidget({
        Key? key,
        required this.adSetting,
        required this.clickTracker,
      }) : super(key: key);
      
      @override
      Widget build(BuildContext context) {
        return GestureDetector(
          onTap: () {
            clickTracker.handleAdClick(
              adSetting.adId,
              linkUrl: adSetting.content.linkUrl,
            );
          },
          child: Container(
            margin: EdgeInsets.all(8.0),
            padding: EdgeInsets.all(16.0),
            decoration: BoxDecoration(
              border: Border.all(color: Colors.grey[300]!),
              borderRadius: BorderRadius.circular(8.0),
              color: Colors.white,
              boxShadow: [
                BoxShadow(
                  color: Colors.grey.withOpacity(0.2),
                  spreadRadius: 1,
                  blurRadius: 3,
                  offset: Offset(0, 2),
                ),
              ],
            ),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                if (adSetting.content.imageUrl != null)
                  ClipRRect(
                    borderRadius: BorderRadius.circular(8.0),
                    child: Image.network(
                      adSetting.content.imageUrl!,
                      height: 200,
                      width: double.infinity,
                      fit: BoxFit.cover,
                    ),
                  ),
                SizedBox(height: 12),
                Text(
                  adSetting.content.title ?? '',
                  style: TextStyle(
                    fontSize: 18,
                    fontWeight: FontWeight.bold,
                  ),
                ),
                SizedBox(height: 8),
                Text(
                  adSetting.content.description ?? '',
                  style: TextStyle(
                    fontSize: 14,
                    color: Colors.grey[600],
                  ),
                ),
                SizedBox(height: 12),
                Container(
                  padding: EdgeInsets.symmetric(horizontal: 16, vertical: 8),
                  decoration: BoxDecoration(
                    color: Theme.of(context).primaryColor,
                    borderRadius: BorderRadius.circular(4),
                  ),
                  child: Text(
                    adSetting.content.buttonText ?? 'Learn More',
                    style: TextStyle(
                      color: Colors.white,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                ),
              ],
            ),
          ),
        );
      }
    }
    ```
  </Tab>
</Tabs>

## Analytics Best Practices

<AccordionGroup>
  <Accordion title="Visibility Threshold">
    **50% Rule**: Track impressions when at least 50% of the ad is visible for at least 1 second. This matches industry standards for viewable impressions.
  </Accordion>
  
  <Accordion title="Deduplication">
    **Avoid Double Tracking**: Ensure each ad impression and click is tracked only once per user session.
    
    ```typescript
    const trackedImpressions = new Set<string>();
    
    const trackImpression = (adId: string) => {
        if (!trackedImpressions.has(adId)) {
            markAdAsSeen(adId);
            trackedImpressions.add(adId);
        }
    };
    ```
  </Accordion>
  
  <Accordion title="Error Handling">
    **Graceful Degradation**: Continue app functionality even if tracking fails. Consider offline queuing for retry.
    
    ```typescript
    const trackWithRetry = async (adId: string, action: 'impression' | 'click') => {
        try {
            await (action === 'impression' ? markAsSeen(adId) : markLinkAsClicked(adId));
        } catch (error) {
            // Queue for retry when network is available
            queueTrackingEvent(adId, action);
        }
    };
    ```
  </Accordion>
  
  <Accordion title="Performance Impact">
    **Optimize Tracking**: Batch tracking calls and avoid blocking the UI thread.
    
    ```typescript
    // Batch tracking calls
    const batchTrackImpressions = (adIds: string[]) => {
        Promise.allSettled(adIds.map(id => markAsSeen(id)))
            .then(results => {
                console.log('Batch tracking completed:', results);
            });
    };
    ```
  </Accordion>
</AccordionGroup>

## Integration Examples

### Feed Integration

```typescript
// Track ads in a scrollable feed
class FeedAdTracker {
    private visibleAds = new Map<string, number>();
    
    onScroll = (visibleItems: Array<{id: string, type: string}>) => {
        visibleItems.forEach(item => {
            if (item.type === 'ad') {
                const viewTime = this.visibleAds.get(item.id) || 0;
                this.visibleAds.set(item.id, viewTime + 100); // Increment by scroll interval
                
                // Track impression after 1 second of visibility
                if (viewTime >= 1000) {
                    this.trackImpression(item.id);
                }
            }
        });
    };
}
```

### Real-time Analytics

```typescript
// Local analytics with periodic sync
class AdAnalytics {
    private localStats = new Map<string, {impressions: number, clicks: number}>();
    
    updateLocalStats(adId: string, type: 'impression' | 'click') {
        const stats = this.localStats.get(adId) || {impressions: 0, clicks: 0};
        stats[type === 'impression' ? 'impressions' : 'clicks']++;
        this.localStats.set(adId, stats);
        
        // Sync every 10 events or 5 minutes
        this.scheduleSyncIfNeeded();
    }
    
    async syncToServer() {
        // Send local analytics to your analytics service
        for (const [adId, stats] of this.localStats) {
            await analyticsService.updateAdStats(adId, stats);
        }
        this.localStats.clear();
    }
}
```

<Tip>
**Console Analytics**: View comprehensive ad performance metrics in your Amity Social Cloud Console, including impressions, clicks, CTR, and revenue data.
</Tip>