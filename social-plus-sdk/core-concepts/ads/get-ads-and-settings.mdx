# Get Ads and Settings

Retrieve ad configuration and settings from your Amity Social Cloud Console to dynamically display ads in your application.

<Info>
**Dynamic Configuration**: Ad settings are managed through the console and retrieved at runtime, allowing you to update ad strategies without app releases.
</Info>

## Overview

The `getNetworkAds()` function fetches all ads and their configuration settings that have been configured in your network console. This enables your application or UIKit to:

- Display ads based on console configuration
- Respect placement and frequency settings
- Adapt to real-time ad strategy changes
- Maintain consistent ad experience across platforms

## Implementation

<Tabs>
  <Tab title="iOS">
    ```swift
    import AmitySDK

    let adRepository = AmityAdRepository(client: client)
    
    // Fetch network ads and settings
    adRepository.getNetworkAds { result in
        switch result {
        case .success(let adSettings):
            print("Retrieved \(adSettings.count) ad configurations")
            
            // Process ad settings
            for adSetting in adSettings {
                print("Ad ID: \(adSetting.adId)")
                print("Placement: \(adSetting.placement)")
                print("Frequency: \(adSetting.frequency)")
                print("Status: \(adSetting.isActive ? "Active" : "Inactive")")
                
                // Configure ad display based on settings
                configureAdDisplay(adSetting)
            }
            
        case .failure(let error):
            print("Failed to get ads: \(error.localizedDescription)")
            // Handle error - potentially show fallback content
        }
    }
    
    private func configureAdDisplay(_ adSetting: AmityAdSetting) {
        // Implement ad display logic based on settings
        switch adSetting.placement {
        case .feedTop:
            setupFeedTopAd(adSetting)
        case .feedMiddle:
            setupFeedMiddleAd(adSetting)
        case .feedBottom:
            setupFeedBottomAd(adSetting)
        default:
            break
        }
    }
    ```
  </Tab>
  <Tab title="Android">
    ```kotlin
    import com.amity.socialcloud.sdk.ads.AmityAdRepository

    val adRepository = AmityAdRepository(client)
    
    // Fetch network ads and settings
    adRepository.getNetworkAds()
        .observeOn(AndroidSchedulers.mainThread())
        .subscribe(
            { adSettings ->
                println("Retrieved ${adSettings.size} ad configurations")
                
                // Process each ad setting
                adSettings.forEach { adSetting ->
                    println("Ad ID: ${adSetting.adId}")
                    println("Placement: ${adSetting.placement}")
                    println("Frequency: ${adSetting.frequency}")
                    println("Status: ${if (adSetting.isActive) "Active" else "Inactive"}")
                    
                    // Configure ad display
                    configureAdDisplay(adSetting)
                }
            },
            { error ->
                println("Failed to get ads: ${error.message}")
                // Handle error appropriately
            }
        )
    
    private fun configureAdDisplay(adSetting: AmityAdSetting) {
        when (adSetting.placement) {
            AmityAdPlacement.FEED_TOP -> setupFeedTopAd(adSetting)
            AmityAdPlacement.FEED_MIDDLE -> setupFeedMiddleAd(adSetting)
            AmityAdPlacement.FEED_BOTTOM -> setupFeedBottomAd(adSetting)
        }
    }
    ```
  </Tab>
  <Tab title="TypeScript">
    ```typescript
    import { AmityAdRepository, AmityAdSetting } from '@amityco/ts-sdk';

    const adRepository = new AmityAdRepository(client);
    
    // Fetch network ads and settings
    const getAndConfigureAds = async (): Promise<void> => {
        try {
            const adSettings: AmityAdSetting[] = await adRepository.getNetworkAds();
            console.log(`Retrieved ${adSettings.length} ad configurations`);
            
            // Process ad settings
            adSettings.forEach(adSetting => {
                console.log('Ad Configuration:', {
                    id: adSetting.adId,
                    placement: adSetting.placement,
                    frequency: adSetting.frequency,
                    isActive: adSetting.isActive,
                    content: adSetting.content
                });
                
                // Configure ad display based on settings
                if (adSetting.isActive) {
                    configureAdDisplay(adSetting);
                }
            });
            
        } catch (error) {
            console.error('Failed to get ads:', error);
            // Handle error - maybe show fallback content or retry
        }
    };
    
    const configureAdDisplay = (adSetting: AmityAdSetting): void => {
        switch (adSetting.placement) {
            case 'feed-top':
                setupFeedTopAd(adSetting);
                break;
            case 'feed-middle':
                setupFeedMiddleAd(adSetting);
                break;
            case 'feed-bottom':
                setupFeedBottomAd(adSetting);
                break;
            case 'story-between':
                setupStoryAd(adSetting);
                break;
            default:
                console.warn('Unknown ad placement:', adSetting.placement);
        }
    };
    
    // Initialize ads when app starts
    await getAndConfigureAds();
    ```
  </Tab>
  <Tab title="React Native">
    ```typescript
    import { AmityAdRepository } from '@amityco/react-native-sdk';

    const adRepository = new AmityAdRepository(client);
    
    const useAds = () => {
        const [adSettings, setAdSettings] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        
        useEffect(() => {
            loadAds();
        }, []);
        
        const loadAds = async () => {
            try {
                setLoading(true);
                const settings = await adRepository.getNetworkAds();
                setAdSettings(settings.filter(ad => ad.isActive));
                setError(null);
            } catch (err) {
                setError(err.message);
                console.error('Failed to load ads:', err);
            } finally {
                setLoading(false);
            }
        };
        
        return { adSettings, loading, error, refetch: loadAds };
    };
    
    // Usage in component
    const FeedScreen = () => {
        const { adSettings, loading } = useAds();
        
        const getAdForPlacement = (placement: string) => {
            return adSettings.find(ad => ad.placement === placement);
        };
        
        return (
            <ScrollView>
                {getAdForPlacement('feed-top') && (
                    <AdComponent ad={getAdForPlacement('feed-top')} />
                )}
                
                {/* Your content here */}
                
                {getAdForPlacement('feed-bottom') && (
                    <AdComponent ad={getAdForPlacement('feed-bottom')} />
                )}
            </ScrollView>
        );
    };
    ```
  </Tab>
  <Tab title="Flutter">
    ```dart
    import 'package:amity_sdk/amity_sdk.dart';

    class AdService {
      final AmityAdRepository _adRepository;
      List<AmityAdSetting> _adSettings = [];
      
      AdService(AmityClient client) : _adRepository = AmityAdRepository(client);
      
      Future<void> loadNetworkAds() async {
        try {
          final adSettings = await _adRepository.getNetworkAds();
          _adSettings = adSettings.where((ad) => ad.isActive).toList();
          
          print('Loaded ${_adSettings.length} active ads');
          
          // Configure ads for different placements
          for (final adSetting in _adSettings) {
            print('Ad: ${adSetting.adId}, Placement: ${adSetting.placement}');
            _configureAdDisplay(adSetting);
          }
          
        } catch (error) {
          print('Failed to load ads: $error');
          // Handle error appropriately
        }
      }
      
      void _configureAdDisplay(AmityAdSetting adSetting) {
        switch (adSetting.placement) {
          case 'feed-top':
            _setupFeedTopAd(adSetting);
            break;
          case 'feed-middle':
            _setupFeedMiddleAd(adSetting);
            break;
          case 'feed-bottom':
            _setupFeedBottomAd(adSetting);
            break;
          default:
            print('Unknown placement: ${adSetting.placement}');
        }
      }
      
      AmityAdSetting? getAdForPlacement(String placement) {
        try {
          return _adSettings.firstWhere((ad) => ad.placement == placement);
        } catch (e) {
          return null; // No ad found for this placement
        }
      }
    }
    
    // Usage in Flutter widget
    class FeedScreen extends StatefulWidget {
      @override
      _FeedScreenState createState() => _FeedScreenState();
    }
    
    class _FeedScreenState extends State<FeedScreen> {
      final AdService _adService = AdService(amityClient);
      
      @override
      void initState() {
        super.initState();
        _adService.loadNetworkAds();
      }
      
      @override
      Widget build(BuildContext context) {
        final topAd = _adService.getAdForPlacement('feed-top');
        final bottomAd = _adService.getAdForPlacement('feed-bottom');
        
        return Column(
          children: [
            if (topAd != null) AdWidget(adSetting: topAd),
            Expanded(child: ContentList()),
            if (bottomAd != null) AdWidget(adSetting: bottomAd),
          ],
        );
      }
    }
    ```
  </Tab>
</Tabs>

## Ad Setting Properties

The `AmityAdSetting` object contains the following properties:

| Property | Type | Description |
|----------|------|-------------|
| `adId` | String | Unique identifier for the ad |
| `placement` | String | Where the ad should be displayed |
| `frequency` | Number | How often the ad should appear |
| `isActive` | Boolean | Whether the ad is currently active |
| `content` | Object | Ad content (images, text, links) |
| `targeting` | Object | Audience targeting criteria |
| `schedule` | Object | When the ad should be shown |

## Common Placements

### Feed Placements
- `feed-top`: At the top of content feeds
- `feed-middle`: Between content items
- `feed-bottom`: At the bottom of feeds

### Story Placements
- `story-between`: Between user stories
- `story-overlay`: Overlay on stories

### Chat Placements
- `chat-banner`: Banner in chat interfaces
- `chat-between`: Between message groups

## Best Practices

<AccordionGroup>
  <Accordion title="Caching Strategy">
    **Cache Ad Settings**: Store ad configurations locally to improve performance and handle offline scenarios.
    
    ```typescript
    // Cache ads for better performance
    const cacheAds = (adSettings: AmityAdSetting[]) => {
        localStorage.setItem('amity_ads', JSON.stringify(adSettings));
    };
    
    const getCachedAds = (): AmityAdSetting[] => {
        const cached = localStorage.getItem('amity_ads');
        return cached ? JSON.parse(cached) : [];
    };
    ```
  </Accordion>
  
  <Accordion title="Error Handling">
    **Graceful Degradation**: Handle ad loading failures without breaking the user experience.
    
    ```typescript
    const loadAdsWithFallback = async () => {
        try {
            return await adRepository.getNetworkAds();
        } catch (error) {
            console.warn('Failed to load ads, using cached version');
            return getCachedAds();
        }
    };
    ```
  </Accordion>
  
  <Accordion title="Performance Optimization">
    **Lazy Loading**: Load ads only when needed to improve initial app performance.
    
    ```typescript
    const loadAdsForPlacement = async (placement: string) => {
        const allAds = await getNetworkAds();
        return allAds.filter(ad => ad.placement === placement && ad.isActive);
    };
    ```
  </Accordion>
  
  <Accordion title="Frequency Management">
    **Respect User Experience**: Implement frequency capping to avoid overwhelming users with ads.
    
    ```typescript
    const shouldShowAd = (adSetting: AmityAdSetting): boolean => {
        const lastShown = getLastAdShownTime(adSetting.adId);
        const minInterval = adSetting.frequency * 1000; // Convert to milliseconds
        return Date.now() - lastShown >= minInterval;
    };
    ```
  </Accordion>
</AccordionGroup>

## Integration Examples

### Dynamic Ad Placement

```typescript
class AdManager {
    private adSettings: AmityAdSetting[] = [];
    
    async initialize() {
        this.adSettings = await adRepository.getNetworkAds();
    }
    
    shouldShowAdAtPosition(placement: string, position: number): boolean {
        const adSetting = this.adSettings.find(ad => 
            ad.placement === placement && ad.isActive
        );
        
        if (!adSetting) return false;
        
        // Show ad based on frequency setting
        return position % adSetting.frequency === 0;
    }
    
    getAdForPlacement(placement: string): AmityAdSetting | null {
        return this.adSettings.find(ad => 
            ad.placement === placement && ad.isActive
        ) || null;
    }
}
```

### Responsive Ad Display

```typescript
const AdComponent: React.FC<{ placement: string }> = ({ placement }) => {
    const [adSetting, setAdSetting] = useState<AmityAdSetting | null>(null);
    
    useEffect(() => {
        const loadAd = async () => {
            const settings = await adRepository.getNetworkAds();
            const relevantAd = settings.find(ad => 
                ad.placement === placement && ad.isActive
            );
            setAdSetting(relevantAd || null);
        };
        
        loadAd();
    }, [placement]);
    
    if (!adSetting) return null;
    
    return (
        <div className="ad-container">
            <img src={adSetting.content.imageUrl} alt="Advertisement" />
            <div className="ad-content">
                <h3>{adSetting.content.title}</h3>
                <p>{adSetting.content.description}</p>
                <button onClick={() => handleAdClick(adSetting)}>
                    {adSetting.content.buttonText}
                </button>
            </div>
        </div>
    );
};
```

<Tip>
**Console Configuration**: Remember to configure your ads in the Amity Social Cloud Console before implementing them in your application. Changes made in the console will be reflected the next time `getNetworkAds()` is called.
</Tip>