# User Management

Understand how Social+ handles user identity and management in your application ecosystem.

<Info>
**No User Data Storage**: Social+ SDK doesn't store or manage user profile data. Users are represented by unique, immutable IDs that you provide from your existing user system.
</Info>

## Core Concepts

### User Identity Model

Social+ uses a **federated identity** approach where:

- **Your Application**: Manages user profiles, authentication, and personal data
- **Social+ SDK**: Handles social interactions using your user IDs as references
- **Immutable IDs**: User identifiers never change throughout the user's lifetime

This design provides several benefits:
- **Privacy Compliance**: No duplicate user data storage
- **Integration Flexibility**: Works with any authentication system
- **Data Ownership**: You maintain full control over user information
- **Scalability**: No data migration or synchronization required

### User ID Requirements

Choose user IDs that are:

✅ **Recommended:**
- Database primary keys (e.g., `user_12345`)
- UUID/GUID values
- Stable internal identifiers

❌ **Not Recommended:**
- Email addresses (can change)
- Usernames (can change)
- Social security numbers (privacy risk)
- Phone numbers (can change)

```typescript
// Good examples
const userId = "user_8a7b9c2d"; // Database ID
const userId = "550e8400-e29b-41d4-a716-446655440000"; // UUID

// Avoid these
const userId = "john.doe@email.com"; // Email can change
const userId = "johndoe123"; // Username can change
```

## User Repository

The `UserRepository` provides essential user query and search capabilities without storing user data.

### Available Operations

| Operation | Description | Use Case |
|-----------|-------------|----------|
| **Get User** | Retrieve user by ID | Display user profiles |
| **Search Users** | Find users by display name | User discovery |
| **List Users** | Get multiple users | Member lists |
| **User Permissions** | Check user roles | Feature access control |

### Implementation

<Tabs>
  <Tab title="iOS">
    ```swift
    import AmitySDK

    // Initialize user repository
    let userRepository = AmityUserRepository(client: client)
    
    // Get user information
    userRepository.getUser(userId: "user_123") { result in
        switch result {
        case .success(let user):
            print("User found: \(user.displayName ?? "Unknown")")
            // Use user data for UI display
            updateUserProfile(user)
            
        case .failure(let error):
            print("Failed to get user: \(error.localizedDescription)")
            // Handle user not found or network error
        }
    }
    
    // Search users by display name
    userRepository.searchUsers(displayName: "John") { result in
        switch result {
        case .success(let users):
            print("Found \(users.count) users")
            // Display search results
            displaySearchResults(users)
            
        case .failure(let error):
            print("Search failed: \(error.localizedDescription)")
        }
    }
    ```
  </Tab>
  <Tab title="Android">
    ```kotlin
    import com.amity.socialcloud.sdk.core.user.AmityUserRepository

    // Initialize user repository
    val userRepository = AmityUserRepository(client)
    
    // Get user information
    userRepository.getUser("user_123")
        .observeOn(AndroidSchedulers.mainThread())
        .subscribe(
            { user ->
                println("User found: ${user.displayName ?: "Unknown"}")
                // Update UI with user data
                updateUserProfile(user)
            },
            { error ->
                println("Failed to get user: ${error.message}")
                // Handle error appropriately
            }
        )
    
    // Search users by display name
    userRepository.searchUsers("John")
        .observeOn(AndroidSchedulers.mainThread())
        .subscribe(
            { users ->
                println("Found ${users.size} users")
                // Display search results
                displaySearchResults(users)
            },
            { error ->
                println("Search failed: ${error.message}")
            }
        )
    ```
  </Tab>
  <Tab title="TypeScript">
    ```typescript
    import { AmityUserRepository } from '@amityco/ts-sdk';

    // Initialize user repository
    const userRepository = new AmityUserRepository(client);
    
    // Get user information
    const getUserInfo = async (userId: string): Promise<AmityUser | null> => {
        try {
            const user = await userRepository.getUser(userId);
            console.log('User found:', user.displayName || 'Unknown');
            return user;
        } catch (error) {
            console.error('Failed to get user:', error);
            return null;
        }
    };
    
    // Search users by display name
    const searchUsers = async (query: string): Promise<AmityUser[]> => {
        try {
            const users = await userRepository.searchUsers({
                displayName: query,
                limit: 20
            });
            console.log(`Found ${users.length} users`);
            return users;
        } catch (error) {
            console.error('Search failed:', error);
            return [];
        }
    };
    
    // Usage examples
    const user = await getUserInfo('user_123');
    const searchResults = await searchUsers('John');
    ```
  </Tab>
  <Tab title="React Native">
    ```typescript
    import { AmityUserRepository } from '@amityco/react-native-sdk';

    // Hook for user management
    const useUserManager = () => {
        const userRepository = useMemo(() => new AmityUserRepository(client), [client]);
        
        const getUser = useCallback(async (userId: string) => {
            try {
                return await userRepository.getUser(userId);
            } catch (error) {
                console.error('Failed to get user:', error);
                return null;
            }
        }, [userRepository]);
        
        const searchUsers = useCallback(async (query: string) => {
            try {
                return await userRepository.searchUsers({
                    displayName: query,
                    limit: 20
                });
            } catch (error) {
                console.error('Search failed:', error);
                return [];
            }
        }, [userRepository]);
        
        return { getUser, searchUsers };
    };
    
    // Usage in component
    const UserSearchScreen = () => {
        const { searchUsers } = useUserManager();
        const [searchResults, setSearchResults] = useState([]);
        const [loading, setLoading] = useState(false);
        
        const handleSearch = async (query: string) => {
            setLoading(true);
            const results = await searchUsers(query);
            setSearchResults(results);
            setLoading(false);
        };
        
        return (
            <View>
                <TextInput 
                    placeholder="Search users..."
                    onChangeText={handleSearch}
                />
                {loading ? (
                    <ActivityIndicator />
                ) : (
                    <FlatList
                        data={searchResults}
                        keyExtractor={(item) => item.userId}
                        renderItem={({ item }) => (
                            <UserListItem user={item} />
                        )}
                    />
                )}
            </View>
        );
    };
    ```
  </Tab>
  <Tab title="Flutter">
    ```dart
    import 'package:amity_sdk/amity_sdk.dart';

    class UserService {
      final AmityUserRepository _userRepository;
      
      UserService(AmityClient client) : _userRepository = AmityUserRepository(client);
      
      // Get user information
      Future<AmityUser?> getUserInfo(String userId) async {
        try {
          final user = await _userRepository.getUser(userId);
          print('User found: ${user.displayName ?? "Unknown"}');
          return user;
        } catch (error) {
          print('Failed to get user: $error');
          return null;
        }
      }
      
      // Search users by display name
      Future<List<AmityUser>> searchUsers(String query) async {
        try {
          final users = await _userRepository.searchUsers(
            displayName: query,
            limit: 20,
          );
          print('Found ${users.length} users');
          return users;
        } catch (error) {
          print('Search failed: $error');
          return [];
        }
      }
      
      // Get multiple users by IDs
      Future<List<AmityUser>> getMultipleUsers(List<String> userIds) async {
        try {
          final users = await _userRepository.getUsers(userIds);
          return users;
        } catch (error) {
          print('Failed to get users: $error');
          return [];
        }
      }
    }
    
    // Usage in Flutter widget
    class UserSearchWidget extends StatefulWidget {
      @override
      _UserSearchWidgetState createState() => _UserSearchWidgetState();
    }
    
    class _UserSearchWidgetState extends State<UserSearchWidget> {
      final UserService _userService = UserService(amityClient);
      List<AmityUser> _searchResults = [];
      bool _loading = false;
      
      void _handleSearch(String query) async {
        if (query.isEmpty) {
          setState(() => _searchResults = []);
          return;
        }
        
        setState(() => _loading = true);
        final results = await _userService.searchUsers(query);
        setState(() {
          _searchResults = results;
          _loading = false;
        });
      }
      
      @override
      Widget build(BuildContext context) {
        return Column(
          children: [
            TextField(
              decoration: InputDecoration(hintText: 'Search users...'),
              onChanged: _handleSearch,
            ),
            if (_loading)
              CircularProgressIndicator()
            else
              Expanded(
                child: ListView.builder(
                  itemCount: _searchResults.length,
                  itemBuilder: (context, index) {
                    final user = _searchResults[index];
                    return ListTile(
                      title: Text(user.displayName ?? 'Unknown'),
                      subtitle: Text('ID: ${user.userId}'),
                      leading: CircleAvatar(
                        backgroundImage: user.avatar != null 
                            ? NetworkImage(user.avatar!) 
                            : null,
                        child: user.avatar == null 
                            ? Icon(Icons.person) 
                            : null,
                      ),
                    );
                  },
                ),
              ),
          ],
        );
      }
    }
    ```
  </Tab>
</Tabs>

## User Roles and Permissions

Assign roles to users for different permission levels and capabilities within your Social+ network.

### Role Management

Roles are configured in the Amity Social Cloud Console and can include:

- **Moderators**: Channel and community moderation privileges
- **Administrators**: Network-wide management capabilities
- **Custom Roles**: Application-specific permission sets
- **Rate Limits**: Different sending and action limits per role

```typescript
// Check user permissions
const checkUserPermissions = async (userId: string): Promise<string[]> => {
    try {
        const user = await userRepository.getUser(userId);
        return user.roles || [];
    } catch (error) {
        console.error('Failed to check permissions:', error);
        return [];
    }
};

// Use permissions for feature access
const canModerateChannel = (userRoles: string[]): boolean => {
    return userRoles.includes('moderator') || userRoles.includes('admin');
};
```

## User Management Operations

The Social+ SDK provides several user management capabilities through different specialized guides:

### Core Operations
- **[Create User](./create-user)**: Initialize users in the Social+ system
- **[Update User Information](./update-user-information)**: Manage user profiles and settings
- **[Get User Information](./get-user-information)**: Retrieve user data and status
- **[Delete User](./delete-user)**: Remove users from the system

### Discovery and Search
- **[Search and Query Users](./search-and-query-users)**: Find users with advanced filtering
- **[User Permissions](./user-permission)**: Manage roles and access control

### Moderation
- **[Flag/Unflag User](./flag-unflag-user)**: Report and moderate user behavior
- **[User Token Management](./user-token-management)**: Handle authentication tokens

## Best Practices

<AccordionGroup>
  <Accordion title="ID Selection Strategy">
    **Use Immutable IDs**: Choose identifiers that will never change throughout the user's lifetime.
    
    ```typescript
    // Recommended approach
    class UserService {
        // Use your database primary key
        private getSocialPlusUserId(user: DatabaseUser): string {
            return `user_${user.id}`;
        }
        
        // Or use UUID if you don't have numeric IDs
        private generateUserId(): string {
            return crypto.randomUUID();
        }
    }
    ```
  </Accordion>
  
  <Accordion title="Error Handling">
    **Handle Missing Users**: Some users might not exist in Social+ but exist in your system.
    
    ```typescript
    const getUserSafely = async (userId: string): Promise<AmityUser | null> => {
        try {
            return await userRepository.getUser(userId);
        } catch (error) {
            if (error.code === 'USER_NOT_FOUND') {
                console.log('User not yet created in Social+');
                return null;
            }
            throw error; // Re-throw other errors
        }
    };
    ```
  </Accordion>
  
  <Accordion title="Search Optimization">
    **Implement Search Throttling**: Avoid excessive API calls during user input.
    
    ```typescript
    import { debounce } from 'lodash';
    
    const debouncedSearch = debounce(async (query: string) => {
        if (query.length >= 2) {
            const results = await userRepository.searchUsers(query);
            setSearchResults(results);
        }
    }, 300);
    ```
  </Accordion>
  
  <Accordion title="Caching Strategy">
    **Cache User Data**: Store frequently accessed user information locally.
    
    ```typescript
    class UserCache {
        private cache = new Map<string, { user: AmityUser; expiry: number }>();
        private readonly TTL = 5 * 60 * 1000; // 5 minutes
        
        async getUser(userId: string): Promise<AmityUser | null> {
            const cached = this.cache.get(userId);
            if (cached && cached.expiry > Date.now()) {
                return cached.user;
            }
            
            const user = await userRepository.getUser(userId);
            if (user) {
                this.cache.set(userId, { 
                    user, 
                    expiry: Date.now() + this.TTL 
                });
            }
            return user;
        }
    }
    ```
  </Accordion>
</AccordionGroup>

## Integration Examples

### User Profile Display

```typescript
// Complete user profile component
const UserProfile: React.FC<{ userId: string }> = ({ userId }) => {
    const [user, setUser] = useState<AmityUser | null>(null);
    const [loading, setLoading] = useState(true);
    
    useEffect(() => {
        const loadUser = async () => {
            setLoading(true);
            const userData = await userRepository.getUser(userId);
            setUser(userData);
            setLoading(false);
        };
        
        loadUser();
    }, [userId]);
    
    if (loading) return <div>Loading...</div>;
    if (!user) return <div>User not found</div>;
    
    return (
        <div className="user-profile">
            <img src={user.avatar || '/default-avatar.png'} alt="Avatar" />
            <h2>{user.displayName || 'Unknown User'}</h2>
            <p>User ID: {user.userId}</p>
            <p>Roles: {user.roles?.join(', ') || 'None'}</p>
        </div>
    );
};
```

### Global User Banning

For users with moderation privileges, you can globally ban users through the Amity Social Cloud Console. When users are globally banned:

- They lose access to the entire Social+ network
- They're removed from all channels and communities
- Their content may be hidden or removed based on your settings

<Warning>
**Moderation Access**: Global banning requires appropriate permissions and should be handled through your application's moderation interface or the ASC Console.
</Warning>

<Tip>
**Architecture Tip**: Keep user profile data in your existing system and use Social+ for social interactions only. This approach maintains data consistency and simplifies privacy compliance.
</Tip>